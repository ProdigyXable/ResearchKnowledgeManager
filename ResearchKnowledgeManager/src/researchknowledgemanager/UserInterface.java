/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package researchknowledgemanager;

import java.awt.event.ActionEvent;
import java.awt.event.WindowEvent;
import java.io.File;
import java.io.IOException;
import javax.swing.AbstractAction;
import javax.swing.DefaultListModel;
import javax.swing.SwingUtilities;

/**
 *
 * @author Xable Enterprises
 */
public class UserInterface extends javax.swing.JFrame {

    ResearchKnowledgeManager rm;
    DefaultListModel statusMessages = new DefaultListModel();

    class MenuAction extends AbstractAction {

        public void actionPerformed(ActionEvent e) {
            String buffer = e.getActionCommand();
            switch (buffer) {
                case "IndexAll": {
                    // Do actions from the RKM class here....
                    newMessage("Indexing all files in the repository folder. Please wait for confirmation message...");
                    rm.fileIndexer.indexAllReturn = rm.fileIndexer.indexFilesAll(rm.repositoryFolder, false, rm);
                    rm.fileIndexer.saveIndexAll(rm.dataDirectory);
                    newMessage("Finished processing all files");
                    break;
                }

                case "IndexNew": {
                    newMessage("Indexing the newest files");
                    rm.fileIndexer.indexNewReturn = rm.fileIndexer.indexFilesNew(rm.repositoryFolder, false, rm);
                    rm.fileIndexer.saveIndexNew(rm.dataDirectory);
                    newMessage("Finished processing new files");
                    break;
                }

                case "Exit": {
                    rm.ui.dispatchEvent(new WindowEvent(rm.ui, WindowEvent.WINDOW_CLOSING));
                    break;
                }

                case "askForFolder": {
                    try {
                        rm.askForRepository(new File(rm.dataDirectory.getAbsoluteFile() + "\\" + rm.repoFileName));
                    } catch (IOException ex) {
                        System.err.println("I/O Error!");
                    }

                    break;
                }

            }
        }
    }

    /**
     * Creates new form UserInterface
     */
    public UserInterface(ResearchKnowledgeManager rm) {
        this.rm = rm;
        // repoFolder = file;
        initComponents();
    }

    void updateTagTree() {
        this.TagTree.setModel(new TagModelTree(this.rm.Tags));
    }

    void updateFileTree() {
        this.FileTree.setModel(new FileModelTree(this.rm.Files));
    }

    void statusMessagesBottom() {
        statusList.ensureIndexIsVisible(statusList.getModel().getSize() - 1);
    }

    private void addMessage(String message) {
        statusMessages.addElement(" " + message);
    }

    public void newMessage(String message) {

        SwingUtilities.invokeLater(() -> {
            addMessage(message);
        });

        SwingUtilities.invokeLater(() -> {
            statusMessagesBottom();
        });
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        statusMessageScrollPane = new javax.swing.JScrollPane();
        statusList = new javax.swing.JList();
        TabbedPane = new javax.swing.JTabbedPane();
        jScrollPane1 = new javax.swing.JScrollPane();
        FileExplorerTree = new javax.swing.JTree();
        jScrollPane3 = new javax.swing.JScrollPane();
        TagTree = new javax.swing.JTree();
        jScrollPane4 = new javax.swing.JScrollPane();
        FileTree = new javax.swing.JTree();
        UserActionPanel = new javax.swing.JPanel();
        jButton4 = new javax.swing.JButton();
        resumeButton = new javax.swing.JButton();
        pauseButton = new javax.swing.JButton();
        cancelButton = new javax.swing.JButton();
        SubmitButton = new javax.swing.JButton();
        QuitButton = new javax.swing.JButton();
        MainPanel = new javax.swing.JPanel();
        MenuBar = new javax.swing.JMenuBar();
        SystemMenu = new javax.swing.JMenu();
        changeRepositoryFolderMenuItem = new javax.swing.JMenuItem();
        jSeparator1 = new javax.swing.JPopupMenu.Separator();
        openHelpDocumentMenuIte0 = new javax.swing.JMenuItem();
        jSeparator2 = new javax.swing.JPopupMenu.Separator();
        cleanDataFilesMenuItem = new javax.swing.JMenuItem();
        jSeparator5 = new javax.swing.JPopupMenu.Separator();
        safelyExitSystem = new javax.swing.JMenuItem();
        TagsMenu = new javax.swing.JMenu();
        automaticallyTagFilesMenuItem = new javax.swing.JMenuItem();
        manuallyTagFilesMenuItem = new javax.swing.JMenuItem();
        jSeparator4 = new javax.swing.JPopupMenu.Separator();
        associateFilesWithTagMenuItem = new javax.swing.JMenuItem();
        associateTagsWithFilesMenuItem = new javax.swing.JMenuItem();
        SearchesMenu = new javax.swing.JMenu();
        initiateSearchQueryMenuItem = new javax.swing.JMenuItem();
        IndexingMenu = new javax.swing.JMenu();
        indexAllFilesMenuItem = new javax.swing.JMenuItem();
        indexNewFilesMenuItem = new javax.swing.JMenuItem();
        jSeparator6 = new javax.swing.JPopupMenu.Separator();
        addSpecificFilesToSystemMenuItem = new javax.swing.JMenuItem();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Research Knowledge Manager - SE Senior Design UTD Fall 2015");
        setBackground(new java.awt.Color(153, 153, 153));
        setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        setMaximumSize(new java.awt.Dimension(1280, 700));
        setMinimumSize(new java.awt.Dimension(1280, 700));
        setPreferredSize(new java.awt.Dimension(1280, 700));
        setResizable(false);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                formWindowClosing(evt);
            }
        });

        statusMessageScrollPane.setBackground(new java.awt.Color(204, 204, 204));
        statusMessageScrollPane.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        statusMessageScrollPane.setAutoscrolls(true);

        statusList.setFont(new java.awt.Font("Verdana", 0, 10)); // NOI18N
        statusList.setModel(this.statusMessages);
        statusList.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        statusList.setDropMode(javax.swing.DropMode.ON);
        statusList.setName("statusList"); // NOI18N
        statusList.setValueIsAdjusting(true);
        statusList.setVisibleRowCount(1);
        statusMessageScrollPane.setViewportView(statusList);
        statusList.getAccessibleContext().setAccessibleName("statusList");

        FileExplorerTree.setFont(new java.awt.Font("Verdana", 0, 10)); // NOI18N
        FileExplorerTree.setModel(new FileTreeModelTree(this.rm.repositoryFolder));
        jScrollPane1.setViewportView(FileExplorerTree);

        TabbedPane.addTab("File Explorer Hierarchy", jScrollPane1);

        TagTree.setModel(new TagModelTree(this.rm.Tags));
        TagTree.setLargeModel(true);
        jScrollPane3.setViewportView(TagTree);

        TabbedPane.addTab("List Of Tags", jScrollPane3);

        FileTree.setModel(new FileModelTree(this.rm.Files));
        jScrollPane4.setViewportView(FileTree);

        TabbedPane.addTab("List of Files", jScrollPane4);

        UserActionPanel.setBackground(new java.awt.Color(204, 204, 204));
        UserActionPanel.setBorder(javax.swing.BorderFactory.createCompoundBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED), new javax.swing.border.LineBorder(new java.awt.Color(153, 153, 153), 1, true)));
        UserActionPanel.setLayout(new java.awt.GridLayout(1, 0));

        jButton4.setFont(new java.awt.Font("Verdana", 1, 10)); // NOI18N
        jButton4.setText("Start Action");
        jButton4.setAlignmentX(0.5F);
        jButton4.setMargin(new java.awt.Insets(2, 6, 2, 6));
        jButton4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton4ActionPerformed(evt);
            }
        });
        UserActionPanel.add(jButton4);
        jButton4.getAccessibleContext().setAccessibleDescription("");

        resumeButton.setFont(new java.awt.Font("Verdana", 1, 10)); // NOI18N
        resumeButton.setText("Resume Action");
        resumeButton.setAlignmentX(0.5F);
        resumeButton.setMargin(new java.awt.Insets(2, 6, 2, 6));
        resumeButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                resumeButtonActionPerformed(evt);
            }
        });
        UserActionPanel.add(resumeButton);
        resumeButton.getAccessibleContext().setAccessibleDescription("");

        pauseButton.setFont(new java.awt.Font("Verdana", 1, 10)); // NOI18N
        pauseButton.setText("Pause Action");
        pauseButton.setAlignmentX(0.5F);
        pauseButton.setMargin(new java.awt.Insets(2, 6, 2, 6));
        pauseButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                pauseButtonActionPerformed(evt);
            }
        });
        UserActionPanel.add(pauseButton);
        pauseButton.getAccessibleContext().setAccessibleDescription("");

        cancelButton.setFont(new java.awt.Font("Verdana", 1, 10)); // NOI18N
        cancelButton.setText("Cancel Action");
        cancelButton.setAlignmentX(0.5F);
        cancelButton.setMargin(new java.awt.Insets(2, 6, 2, 6));
        UserActionPanel.add(cancelButton);
        cancelButton.getAccessibleContext().setAccessibleDescription("");

        SubmitButton.setFont(new java.awt.Font("Verdana", 1, 10)); // NOI18N
        SubmitButton.setText("Ok / Submit");
        SubmitButton.setAlignmentX(0.5F);
        SubmitButton.setEnabled(false);
        SubmitButton.setMargin(new java.awt.Insets(2, 6, 2, 6));
        UserActionPanel.add(SubmitButton);
        SubmitButton.getAccessibleContext().setAccessibleDescription("");

        QuitButton.setFont(new java.awt.Font("Verdana", 1, 10)); // NOI18N
        QuitButton.setText("Quit");
        QuitButton.setAlignmentX(0.5F);
        QuitButton.setEnabled(false);
        QuitButton.setMargin(new java.awt.Insets(2, 6, 2, 6));
        UserActionPanel.add(QuitButton);
        QuitButton.getAccessibleContext().setAccessibleDescription("");

        MainPanel.setBackground(new java.awt.Color(229, 229, 229));
        MainPanel.setBorder(javax.swing.BorderFactory.createCompoundBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED), new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0), 1, true)));

        javax.swing.GroupLayout MainPanelLayout = new javax.swing.GroupLayout(MainPanel);
        MainPanel.setLayout(MainPanelLayout);
        MainPanelLayout.setHorizontalGroup(
            MainPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );
        MainPanelLayout.setVerticalGroup(
            MainPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 413, Short.MAX_VALUE)
        );

        SystemMenu.setText("System");
        SystemMenu.addMenuListener(new javax.swing.event.MenuListener() {
            public void menuCanceled(javax.swing.event.MenuEvent evt) {
                SystemMenuMenuCanceled(evt);
            }
            public void menuDeselected(javax.swing.event.MenuEvent evt) {
            }
            public void menuSelected(javax.swing.event.MenuEvent evt) {
            }
        });

        changeRepositoryFolderMenuItem.setAction(new MenuAction());
        changeRepositoryFolderMenuItem.setText("Change Repository Folder");
        changeRepositoryFolderMenuItem.setActionCommand("askForFolder");
        changeRepositoryFolderMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                changeRepositoryFolderMenuItemActionPerformed(evt);
            }
        });
        SystemMenu.add(changeRepositoryFolderMenuItem);
        SystemMenu.add(jSeparator1);

        openHelpDocumentMenuIte0.setText("Open Help Document");
        SystemMenu.add(openHelpDocumentMenuIte0);
        SystemMenu.add(jSeparator2);

        cleanDataFilesMenuItem.setText("Clean Data Files");
        cleanDataFilesMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cleanDataFilesMenuItemActionPerformed(evt);
            }
        });
        SystemMenu.add(cleanDataFilesMenuItem);
        SystemMenu.add(jSeparator5);

        safelyExitSystem.setAction(new MenuAction());
        safelyExitSystem.setText("Safely Exit System");
        safelyExitSystem.setActionCommand("Exit");
        safelyExitSystem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                safelyExitSystemActionPerformed(evt);
            }
        });
        SystemMenu.add(safelyExitSystem);

        MenuBar.add(SystemMenu);

        TagsMenu.setText("Tags");

        automaticallyTagFilesMenuItem.setText("Automatically Tag Files");
        TagsMenu.add(automaticallyTagFilesMenuItem);

        manuallyTagFilesMenuItem.setText("Manually Tag Files");
        manuallyTagFilesMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                manuallyTagFilesMenuItemActionPerformed(evt);
            }
        });
        TagsMenu.add(manuallyTagFilesMenuItem);
        TagsMenu.add(jSeparator4);

        associateFilesWithTagMenuItem.setText("Modify Files Associated with a Tag");
        TagsMenu.add(associateFilesWithTagMenuItem);

        associateTagsWithFilesMenuItem.setText("Modify Tags Associated with a File");
        TagsMenu.add(associateTagsWithFilesMenuItem);

        MenuBar.add(TagsMenu);

        SearchesMenu.setText("Searches");

        initiateSearchQueryMenuItem.setAction(new MenuAction());
        initiateSearchQueryMenuItem.setText("Initiate Search Query");
        initiateSearchQueryMenuItem.setActionCommand("initiateSearchQuery");
        SearchesMenu.add(initiateSearchQueryMenuItem);

        MenuBar.add(SearchesMenu);

        IndexingMenu.setText("Indexing");

        indexAllFilesMenuItem.setAction(new MenuAction());
        indexAllFilesMenuItem.setText("Index All Files");
        indexAllFilesMenuItem.setActionCommand("IndexAll");
        IndexingMenu.add(indexAllFilesMenuItem);

        indexNewFilesMenuItem.setAction(new MenuAction());
        indexNewFilesMenuItem.setText("Index New Files");
        indexNewFilesMenuItem.setActionCommand("IndexNew");
        IndexingMenu.add(indexNewFilesMenuItem);
        IndexingMenu.add(jSeparator6);

        addSpecificFilesToSystemMenuItem.setText("Add Specific Files to System");
        IndexingMenu.add(addSpecificFilesToSystemMenuItem);

        MenuBar.add(IndexingMenu);

        setJMenuBar(MenuBar);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(statusMessageScrollPane, javax.swing.GroupLayout.PREFERRED_SIZE, 595, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(UserActionPanel, javax.swing.GroupLayout.DEFAULT_SIZE, 649, Short.MAX_VALUE))
                    .addComponent(TabbedPane)
                    .addComponent(MainPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGap(6, 6, 6)
                .addComponent(TabbedPane, javax.swing.GroupLayout.PREFERRED_SIZE, 125, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(MainPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.CENTER)
                    .addComponent(UserActionPanel, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(statusMessageScrollPane, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(6, 6, 6))
        );

        getAccessibleContext().setAccessibleName("Research Knowledge Manager - SE Senior Design");

        setBounds(0, 0, 1296, 700);
    }// </editor-fold>//GEN-END:initComponents

    private void SystemMenuMenuCanceled(javax.swing.event.MenuEvent evt) {//GEN-FIRST:event_SystemMenuMenuCanceled
        // TODO add your handling code here:
    }//GEN-LAST:event_SystemMenuMenuCanceled

    private void changeRepositoryFolderMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_changeRepositoryFolderMenuItemActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_changeRepositoryFolderMenuItemActionPerformed

    private void manuallyTagFilesMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_manuallyTagFilesMenuItemActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_manuallyTagFilesMenuItemActionPerformed

    private void pauseButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_pauseButtonActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_pauseButtonActionPerformed

    private void cleanDataFilesMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cleanDataFilesMenuItemActionPerformed
        // TODO add your handling code here:
        ConfirmationDialog confirm = new ConfirmationDialog(this, true);
        confirm.setVisible(true);
        if (confirm.getReturnStatus() == 1) {
            this.rm.clean();
        }

    }//GEN-LAST:event_cleanDataFilesMenuItemActionPerformed

    private void formWindowClosing(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosing
        // TODO add your handling code here:
        this.rm.exit();
        System.exit(0);
    }//GEN-LAST:event_formWindowClosing

    private void safelyExitSystemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_safelyExitSystemActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_safelyExitSystemActionPerformed

    private void resumeButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_resumeButtonActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_resumeButtonActionPerformed

    private void jButton4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton4ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jButton4ActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    protected javax.swing.JTree FileExplorerTree;
    private javax.swing.JTree FileTree;
    private javax.swing.JMenu IndexingMenu;
    private javax.swing.JPanel MainPanel;
    private javax.swing.JMenuBar MenuBar;
    private javax.swing.JButton QuitButton;
    private javax.swing.JMenu SearchesMenu;
    private javax.swing.JButton SubmitButton;
    private javax.swing.JMenu SystemMenu;
    private javax.swing.JTabbedPane TabbedPane;
    private javax.swing.JTree TagTree;
    private javax.swing.JMenu TagsMenu;
    private javax.swing.JPanel UserActionPanel;
    private javax.swing.JMenuItem addSpecificFilesToSystemMenuItem;
    private javax.swing.JMenuItem associateFilesWithTagMenuItem;
    private javax.swing.JMenuItem associateTagsWithFilesMenuItem;
    private javax.swing.JMenuItem automaticallyTagFilesMenuItem;
    private javax.swing.JButton cancelButton;
    private javax.swing.JMenuItem changeRepositoryFolderMenuItem;
    private javax.swing.JMenuItem cleanDataFilesMenuItem;
    private javax.swing.JMenuItem indexAllFilesMenuItem;
    private javax.swing.JMenuItem indexNewFilesMenuItem;
    private javax.swing.JMenuItem initiateSearchQueryMenuItem;
    private javax.swing.JButton jButton4;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JPopupMenu.Separator jSeparator1;
    private javax.swing.JPopupMenu.Separator jSeparator2;
    private javax.swing.JPopupMenu.Separator jSeparator4;
    private javax.swing.JPopupMenu.Separator jSeparator5;
    private javax.swing.JPopupMenu.Separator jSeparator6;
    private javax.swing.JMenuItem manuallyTagFilesMenuItem;
    private javax.swing.JMenuItem openHelpDocumentMenuIte0;
    private javax.swing.JButton pauseButton;
    private javax.swing.JButton resumeButton;
    private javax.swing.JMenuItem safelyExitSystem;
    private javax.swing.JList statusList;
    private javax.swing.JScrollPane statusMessageScrollPane;
    // End of variables declaration//GEN-END:variables

}
